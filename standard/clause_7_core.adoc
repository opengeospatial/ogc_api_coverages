== Requirements Class "Core"

[[core-overview]]
=== Overview

include::requirements/requirements_class_core.adoc[]

The OGC API family of standards is organized by resource type. OGC API - Coverages specifies the fundamental API building blocks for interacting with coverages. The spatial data community uses the term 'coverage' for homogeneous collections of values located in space/time, such as spatio-temporal sensor, image, simulation, and statistics data.

If you are unfamiliar with the term 'coverage', the explanations on the http://myogc.org/go/coveragesDWG[Coverages DWG Wiki] provide more detail and links to educational material. Additionally, https://www.w3.org/TR/sdw-bp/#coverages[Coverages: describing properties that vary with location (and time)] in the W3C/OGC Spatial Data on the Web Best Practice document may be considered.

This https://github.com/opengeospatial/ogc_api_coverages[OGC API - Coverages] specification establishes how to access coverages as defined by the http://docs.opengeospatial.org/is/09-146r6/09-146r6.html[Coverage Implementation Schema (CIS) 1.1] through Web APIs. A high-level view of the CIS data model is provided in <<abstract-coverage-figure>>.

[#abstract-coverage-figure,reftext='{figure-caption} {counter:fig-num}']
.Abstract Coverage
image::standard/figures/Abstract_Coverage.png[]

This `Core` Requirements Class defines the requirements for locating, understanding, sub-setting, and accessing coverage resources. However, it does not specify any formats for the returned resources. The formats available to implementors of this standard are specified in additional Requirements Classes.

[[dependencies]]
=== Dependencies

The OGC API-Coverages standard is an extension of the OGC API-Common standard. Therefore, an implementation of API-Coverages must first satisfy the appropriate Requirements Classes from API-Common.

include::requirements/core/REQ_api-common.adoc[]

<<mapping-to-common>> Identifies the API-Common Requirements Classes which are applicable to each section of this Standard. Instructions on when and how to apply these Requirements Classes are provided in each section.

[#mapping-to-common,reftext='{table-caption} {counter:table-num}']
.Mapping API-Coverages Sections to API-Common Requirements Classes
[width="90%",cols="2,6"]
|====
^|*API-Coverage Section* ^|*API-Common Requirements Class*
|<<landing-page,API Landing Page>>| http://www.opengis.net/spec/ogcapi_common/1.0/req/core
|<<api-definition,API Definition>>| http://www.opengis.net/spec/ogcapi_common/1.0/req/core
|<<conformance-classes,Declaration of Conformance Classes>>| http://www.opengis.net/spec/ogcapi_common/1.0/req/core
|<<collections,Collections>>| http://www.opengis.net/spec/ogcapi_common/1.0/req/collections
|<<collections,OpenAPI 3.0>>| http://www.opengis.net/spec/ogcapi_common/1.0/req/oas30
|<<collections,GeoJSON>>| http://www.opengis.net/spec/ogcapi_common/1.0/req/geojson
|<<collections,HTML>>| http://www.opengis.net/spec/ogcapi_common/1.0/req/html
|====

[[path-summary]]
=== Path Summary

Resources exposed through an OGC API are accessed through a Universal Resource Identifier <<rfc3986,(URI).>> URIs are composed of three sections:

* Service Offering: The service endpoint (subsequently referred to as Base URI or {root})
* Access Paths: Unique paths to Resources
* Query: Parameters to adjust the representation of a Resource or Resources like encoding format or subsetting

<<coverage-paths>> summarizes the access paths defined in this standard.

[#coverage-paths,reftext='{table-caption} {counter:table-num}']
.Coverage API Paths
[width="90%",cols="2,4",options="header"]
|===
^|**Path Template** ^|**Resource**
2+^|**Common**
|<<landing-page,{root}/>> |Landing page
|<<api-definition,{root}/api>> |API Description (optional)
|<<conformance-classes,{root}/conformance>> |Conformance Classes
|<<collections,{root}/collections>> |Metadata describing the spatial collections available from this API.
|<<collectionInfo,{root}/collections/{collectionId}>> |Metadata describing the collection which has the unique identifier `{collectionId}`
2+^|**Coverages**
|<<coverage-clause,{root}/collections/{collectionId}/coverage>> |A general description of the coverage identified by {collectionId} including the coverage's envelope.
|<<coverage-description-clause,{root}/collections/{collectionid}/coverage/description>> |returns the whole coverage description consisting of domainset, rangetype, and metadata (but not the rangeset)
|<<coverage-domainset-clause,{root}/collections/{collectionid}/coverage/domainset>> |returns the coverage's domain set definition
|<<coverage-rangetype-clause,root}/collections/{collectionid}/coverage/rangetype>> |returns the coverage's range type information (i.e., a description of the data semantics)
|<<coverage-metadata-clause,{root}/collections/{collectionid}/coverage/metadata>> |returns the coverage's metadata (may be empty)
|<<coverage-rangeset-clause,{root}/collections/{collectionid}/coverage/rangeset>> |returns the coverage's range set, i.e., the actual values in the coverage's Native Format (see format encoding for ways to retrieve inspecific formats)
|<<coverage-all-clause,{root}/collections/{collectionid}/coverage/all>> |returns all of the above namely the coverage's domainset, rangetype, metadata, and rangeset comparable to a GetCoverage response
|===

Where:

* {root} = Base URI for the API server
* {collectionId} = an identifier for a specific collection

[[api-platform]]
=== Platform

[[landing-page]]
==== API landing page

The landing page provides links to start exploring the resources offered by the API instance. It mainly consists of a list of links. OGC API-Common already requires some common links. Those links are sufficient for this core.

.Dependencies
[width="90%"]
|====
|http://www.opengis.net/spec/ogcapi_common/1.0/req/core
|====

===== Operation

This operation is defined in the `Core` conformance class of API-Common. No modifications are needed to support `Coverage` resources. The `Core` conformance class describes one way of performing this operation:

. Follow the `/` path

Support for the `/` path is required by API-Common.

===== Response

include::requirements/core/REQ_root-success.adoc[]

The Response to the Landing Page operation is defined in API-Common. However, this resource is extended for use with Coverages. The schema for this resource is provided in <<landingPage-schema>>.

[#landingPage-schema,reftext='Landing Page Response Schema']
.Landing Page Response Schema
[source,yaml]
----
include::common/schemas/landingPage.yaml[]
----

The following JSON fragment is an example of a response to an OGC API-Coverages Landing Page operation.

[#landingPage-example,reftext=`Landing Page Example`]
.Landing Page Example
[source,json]
----
include::examples/JSON/landingPage_example.json[]
----

===== Error situations

See <<http-status-codes,HTTP Status Codes>> for general guidance.

[[api-definition]]
==== API definition

Every API is expected to provide a definition that describes the capabilities of that API. This definition can be used by developers to understand the API, by software clients to connect to the server, or by development tools to support the implementation of servers and clients.

.Dependencies
[width="90%"]
|====
|http://www.opengis.net/spec/ogcapi_common/1.0/req/core
|====

===== Operation

This operation is defined in the `Core` conformance class of API-Common. No modifications are needed to support `Coverage` resources. The `Core` conformance class describes two ways of performing this operation:

. Follow the /api path
. Follow the `service-desc` link on the landing page

Only the link is required by API-Common.

===== Response

API-Common leaves the selection of format for the API Definition response to the API implementor. However, the options are limited to those which have been defined in the API-Common standard. At this time, there is only one option, OpenAPI version 3.0.

===== Error situations

See <<http_status_codes>> for general guidance.

[[conformance-classes]]
==== Declaration of conformance classes

To support "generic" clients that want to access multiple OGC API standards and extensions - and not "just" a specific API / server, the API has to declare the conformance classes it implements and conforms to.

.Dependencies
[width="90%"]
|====
|http://www.opengis.net/spec/ogcapi_common/1.0/req/core
|====

===== Operation

This operation is defined in the `Core` conformance class of API-Common. No modifications are needed to support `Coverage` resources. The `Core` conformance class describes two ways of performing this operation:

. Follow the /conformance path
. Follow the `conformance` link on the landing page

Both techniques are required by API-Common.

===== Response

include::requirements/core/REQ_core_conformance.adoc[]

The Response to the Conformance operation is a list of URLs. Each URL identifies an OGC Conformance Class for which this API claims conformance. The schema for this resource is defined in API-Common and provided for reference in <<conformance-schema>>.

[#conformance-schema,reftext='Conformance Response Schema']
.Conformance Response Schema
[source,yaml]
----
include::openapi/schemas/Common/confClasses.yaml[]
----

The following JSON fragment is an example of a response to an OGC API-Coverages conformance operation.

[#conformance-example,reftext=`Conformance Information Example`]
.Conformance Information Example
[source,json]
----
include::examples/JSON/conformance_example.json[]
----

===== Error situations

See <<http_status_codes>> for general guidance.

=== Coverage Access Paths

In this clause, the path component of https://github.com/opengeospatial/ogc_api_coverages[OGC API - Coverages] access is established.

Access paths follow the XML Schema of http://docs.opengeospatial.org/is/09-146r6/09-146r6.html[CIS] in their structure.

To access coverage service constituents, such as formats supported, OGC 14-121 Web Query Service provides guidance, see https://github.com/opengeospatial/ogc_api_coverages/blob/master/CIS%2BWCS-standards/14-121_Web-Query-Service_2016-06-19.pdf[https://github.com/opengeospatial/ogc_api_coverages/blob/master/CIS%2BWCS-standards/14-121_Web-Query-Service_2016-06-19.pdf].

[[collections]]
==== Collections

TBD

.Dependencies
[width="90%"]
|====
|http://www.opengis.net/spec/ogcapi_common/1.0/req/collections
|====

===== Operation

This operation is defined in the `Collections` conformance class of API-Common. No modifications are needed to support `Coverage` resources. The `Collections` conformance class describes two ways of performing this operation:

. Follow the `/collections` path
. Follow the `data` link on the landing page

Support for both the `/collections` path and the `data` link is required by API-Common.

===== Response

[#collections-schema,reftext='Collections Response Schema']
.Collections Response Schema
[source,yaml]
----
include::openapi/schemas/Common/collections.yaml[]
----

The following JSON fragment is an example of a response to an OGC API-Coverages Collections operation.

[#conllections-example,reftext=`Collections Example`]
.Collections Example
[source,json]
----
include::examples/JSON/collections_example.json[]
----

===== Error situations

See <<http_status_codes>> for general guidance.

[[collectionInfo]]
==== Collection Information

TBD

.Dependencies
[width="90%"]
|====
|http://www.opengis.net/spec/ogcapi_common/1.0/req/collections
|====

===== Operation

This operation is defined in the `Collections` conformance class of API-Common. No modifications are needed to support `Coverage` resources. The `Collections` conformance class describes two ways of performing this operation:

. Follow the `/collections/{collectionId}` path
. Follow the `coverage` link on the collections info page

Support for both the `/collections/{collectionId}` path and the `dataset` link is required by API-Common.

The {collectionId} parameter is the unique identifier for a single collection on the API.

===== Response

[#collectionInfo-schema,reftext='Collection Information Response Schema']
.Collection Information Response Schema
[source,yaml]
----
include::openapi/schemas/Common/collectionInfo.yaml[]
----

The following JSON fragment is an example of a response to an OGC API-Coverages Collection Information operation.

[#collection-info-example,reftext=`Collection Information Example`]
.Collection Information Example
[source,json]
----
include::examples/JSON/collection_info_example.json[]
----

===== Error situations

See <<http_status_codes>> for general guidance.

=== Coverage Access

This section is about coverage access, which is driven by the coverage structure.

The paths discussed in this section are all branches off of the `/collections/{collectionId}/coverage` root.

[[coverage-clause]]
==== Coverage Offering

Returns a general coverage offering description consisting of envelop, rangetype, and service metadata like the coverage's native format

===== Operation

include::requirements/core/REQ_cov-offer-op.adoc[]

===== Response

include::requirements/core/REQ_cov-offer-success.adoc[]

[#coverage-schema,reftext='Coverage Offering Response Schema']
.Coverage Offering Response Schema
[source,yaml]
----
include::openapi/schemas/CIS/coverage_offering.yaml[]
----

The following JSON fragment is an example of a response to a Coverage Offering request.

[#coverage-offering-example,reftext=`Coverage Offering Example`]
.Coverage Offering Example
[source,json]
----
include::examples/JSON/coverage_offering_example.json[]
----

===== Error situations

See <<http_status_codes>> for general guidance.

[[coverage-description-clause]]
==== Coverage Description

Returns the whole coverage description consisting of domainset, rangetype, and metadata (but not the rangeset)

===== Operation

include::requirements/core/REQ_cov-desc-op.adoc[]

===== Response

include::requirements/core/REQ_cov-desc-success.adoc[]

[#coverage-description-schema,reftext='Coverage Description Response Schema']
.Coverage Description Response Schema
[source,yaml]
----
include::openapi/schemas/CIS/coverage_description.yaml[]
----

The following JSON fragment is an example of a response to a Coverage Description request.

[#coverage-description-example,reftext=`Coverage Description Example`]
.Coverage Description Example
[source,json]
----
include::examples/JSON/coverage_description_example.json[]
----

===== Error situations

See <<http_status_codes>> for general guidance.

[[coverage-domainset-clause]]
==== Coverage Domain Set

returns the coverage’s domain set definition

===== Operation

include::requirements/core/REQ_cov-ds-op.adoc[]

===== Response

include::requirements/core/REQ_cov-ds-success.adoc[]

[#coverage-domainset-schema,reftext='Coverage Domain Set Response Schema']
.Coverage Domain Set Response Schema
[source,yaml]
----
include::openapi/schemas/CIS/coverage_domainset.yaml[]
----

The following JSON fragment is an example of a response to a Coverage DomainSet request.

[#coverage-domainset-example,reftext=`Coverage DomainSet Example`]
.Coverage DomainSet Example
[source,json]
----
include::examples/JSON/coverage_domainset_example.json[]
----

===== Error situations

See <<http_status_codes>> for general guidance.

[[coverage-rangetype-clause]]
==== Coverage Range Type

returns the coverage’s range type information (i.e., a description of the data semantics)

===== Operation

include::requirements/core/REQ_cov-rt-op.adoc[]

===== Response

include::requirements/core/REQ_cov-rt-success.adoc[]

[#coverage-rangetype-schema,reftext='Coverage Range Type Response Schema']
.Coverage Range Type Response Schema
[source,yaml]
----
include::openapi/schemas/CIS/coverage_rangetype.yaml[]
----

The following JSON fragment is an example of a response to a Coverage RangeType request.

[#coverage-rangetype-example,reftext=`Coverage RangeType Example`]
.Coverage RangeType Example
[source,json]
----
include::examples/JSON/coverage_rangetype_example.json[]
----

===== Error situations

See <<http_status_codes>> for general guidance.

[[coverage-rangeset-clause]]
==== Coverage Range Set

returns the coverage’s range set, i.e., the actual values in the coverage’s Native Format (see format encoding for ways to retrieve inspecific formats)

===== Operation

include::requirements/core/REQ_cov-rs-op.adoc[]

===== Response

include::requirements/core/REQ_cov-rs-success.adoc[]

[#coverage-rangeset-schema,reftext='Coverage Range Set Response Schema']
.Coverage Range Set Response Schema
[source,yaml]
----
include::openapi/schemas/CIS/coverage_rangeset.yaml[]
----

The following JSON fragment is an example of a response to a Coverage RangeSet request.

[#coverage-rangeset-example,reftext=`Coverage RangeSet Example`]
.Coverage RangeSet Example
[source,json]
----
include::examples/JSON/coverage_rangeset_example.json[]
----

===== Error situations

See <<http_status_codes>> for general guidance.

[[coverage-metadata-clause]]
==== Coverage Metadata

returns the coverage’s metadata (may be empty)

===== Operation

include::requirements/core/REQ_cov-md-op.adoc[]

===== Response

include::requirements/core/REQ_cov-md-success.adoc[]

[#coverage-metadata-schema,reftext='Coverage Metadata Response Schema']
.Coverage Metadata Response Schema
[source,yaml]
----
include::openapi/schemas/CIS/coverage_metadata.yaml[]
----

The following JSON fragment is an example of a response to a Coverage Metadata request.

[#coverage-metadata-example,reftext=`Coverage Metadata Example`]
.Coverage Metadata Example
[source,json]
----
include::examples/JSON/coverage_metadata_example.json[]
----

===== Error situations

See <<http_status_codes>> for general guidance.

[[coverage-all-clause]]
==== Coverage All

returns all of the above namely the coverage’s domainset, rangetype, meatadata, and rangeset comparable to a GetCoverage response

===== Operation

include::requirements/core/REQ_cov-all-op.adoc[]

===== Response

include::requirements/core/REQ_cov-all-success.adoc[]

[#coverage--schema,reftext='Coverage Response Schema']
.Coverage Response Schema
[source,yaml]
----
include::openapi/schemas/CIS/coverage_all.yaml[]
----

The following JSON fragment is an example of a response to a Coverage All request.

[#coverage-all-example,reftext=`Coverage All Example`]
.Coverage All Example
[source,json]
----
include::examples/JSON/coverage_all_example.json[]
----

===== Error situations

See <<http_status_codes>> for general guidance.

=== Coverage Subsetting

The third part is about query parameters:

*   http://acme.com/oapi/collections/%7Bcollectionid%7D/coverage?SUBSET=Lat(40,50)&SUBSET=Long(10,20)[http://acme.com/oapi/collections/{collectionid}/coverage?SUBSET=Lat(40_50)&SUBSET=Long(10_20)]  -- returns a cutout from the coverage identified with extent between corner coordinates (40,10) and (50,20) (note: replace the _ in the URL by a comma character - an adoc issue)

*   http://acme.com/oapi/collections/%7Bcollectionid%7D/coverage/rangeset?SUBSET=Lat(40,50)&SUBSET=Long(10,20)[http://acme.com/oapi/collections/{collectionid}/coverage/rangeset?SUBSET=Lat(40_50)&SUBSET=Long(10_20)]  -- returns the range set of a coverage cutout between (40,10) and (50,20), in the coverage’s Native Format; no domain set, range type, and metadata will be returned (note: replace the _ in the URL by a comma character - an adoc issue)

*   http://acme.com/oapi/collections/%7Bcollectionid%7D/coverage?SUBSET=time(%222019-03-27%22)[http://acme.com/oapi/collections/{collectionid}/coverage?SUBSET=time("2019-03-27")]  -- returns a coverage slice at the timestamp given (in case the coverage is Lat/Long/time the result will be a 2D image)

=== Coverage Query Parameters

In this clause, the query component of https://github.com/opengeospatial/ogc_api_coverages[OGC API - Coverages] access is established.

Subsetting parameters may be mixed in a query part, in no particular order.

